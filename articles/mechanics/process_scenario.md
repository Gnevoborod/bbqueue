# Старт процесса

## Посетитель подходит к автомату выдачи талонов.

1. Посетитель выбирает подраздел, затем выбирает цель посещения.
   1. Формируется запрос на бэкэнд на получение номера талона (GET /endpoints/ticket:ticket).
   1. Ответ с бэкэнда обрабатывается в автомате, печатается талон.
2. Посетитель ожидает вызова.
   1. На экране отображаются данные из очереди (endpoints/queue:queue)


## Сотрудник проводит приём посетителей (начало или продолжение работы).

1. Сотрудник нажимает кнопку "Пригласить следующего посетителя" или "Начать работу с очередью".
   1. Формируется запрос на бэкэнд на вызов следующего посетителя (endpoints/queue:next_customer)
1. На мониторе с отображением очереди отображается номер посетителя и номер окна, к которому посетитель приглашается. Данные забираются из очереди с помощью (endpoints/queue:queue)
1. Посетитель подходит к окну. Сотрудник проводит работу. Если процесс прямой - сотрудник никуда не переводит посетителя. Иначе см.далее

## Сотрудник проводит приём посетителей (посетитель не пришёл)

1. Сотрудник нажимает кнопку "Пригласить следующего посетителя" или "Начать работу с очередью".
   1. Формируется запрос на бэкэнд на вызов следующего посетителя (endpoints/queue:next_customer)
1. На мониторе с отображением очереди отображается номер посетителя и номер окна, к которому посетитель приглашается. Данные забираются из очереди с помощью (endpoints/queue:queue)
1. Посетитель не подходит к окну.
1. Сотрудник ждёт определённое количество времени, затем вновь нажимает кнопку "Пригласить следующего посетителя".


## Сотрудник переводит посетителя в другое окно.

1. Сотрудник нажимает кнопку "Переадресовать посетителя к другому сотруднику".
   1. Формируется запрос на бэкэнд на подтягивание списка целей (endpoints/department:targets)(если ранее подобный запрос не осуществлялся, тут уже фронтовая логика - как часто дёргать этот эндпоинт). Предполагается что сотрудник точно знает какую цель указать при перенаправлении.
1. Сотрудник выбирает в выпадающем списке цель, и нажимает кнопку "Переадресовать". Номер талона подтягивается автоматически, так работа с талоном продолжается до тех пор, пока сотрудник явно не нажмёт одну из кнопок доступных на его рабочем месте(см. actors.md).
   1. Формируется запрос на бэкэнд на эндпоинт (POST /endpoints/ticket:ticket/redirect)
1. Сотрудник возвращает талон посетителю.
1. Посетитель переходит ожидает вызова.

## Сотрудник вызывает посетителя с определённым талоном.

1. Сотрудник нажимает кнопку "Пригласить посетителя с талоном номер".
   1. Формируется запрос на бэкэнд на получение списка талонов (endpoints/ticket:list)
1. На мониторе с отображением очереди отображается выпадающий список с номерами талонов.
1. Сотрудник выбирает нужный номер талона и жмёт кнопку "Пригласить".
   1. Формируется запрос на бэкэнд на эндпоинт (POST /endpoints/queue:next_customer_specific)
1. Посетитель подходит к окну. Сотрудник проводит работу. Если процесс прямой - сотрудник никуда не переводит посетителя. Иначе см.далее

## Сотрудник уходит на перерыв.

1. Сотрудник нажимает кнопку "Приостановить приём".
   1. Формируется запрос на бэкэнд на эндпоинт приостановки приёма (POST endpoints/queue:employee_work), в параметр Action записывается 0.
1. Для возобновления работы сотрудник затем нажимает кнопку "Пригласить следующего посетителя".

## Сотрудник завершает работу.

1. Сотрудник нажимает кнопку "Завершить работу с очередью".
   1. Формируется запрос на бэкэнд на эндпоинт приостановки приёма (POST endpoints/queue:employee_work), в параметр Action записывается 1.
1. Для возобновления работы сотрудник затем нажимает кнопку "Начать работу с очередью".

## Сотрудник завершает работу с посетителем.

1. Сотрудник нажимает кнопку "Завершить работу с посетителем".
   1. Формируется запрос на бэкэнд на эндпоинт завершения работы с посетителем (DELETE enpdoints/queue:ticket)


## Посетители кончились

1. Сотрудник ожидает посетителей, но они не приходят. Вероятно кончились. Заставлять сотрудника жать на кнопку каждую минуту бесчеловечною
1. Сотрудник нажимает кнопку "Ожидать посетителей".
   1. Формируется запрос на бэкэнд на эндпоинт перевода конкретного сотрудника в режим ожидания (POST endpoints/queue:wait)
1. Фронт прослушивает адрес (GET endpoints/queue:customer_appear/{TargetCode}) по SSE.
1. В момент появления посетителя, эндпоинт из пункта выше уведомляет фронт о появлении нового посетителя.
1. Сотруднику на экране монитора отображается информация о появлении посетителя.
1. Сотрудник нажимает кнопку "Пригласить следующего посетителя".