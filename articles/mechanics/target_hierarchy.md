# Описание иерархии отделов\целей

Иерархия состоит из четырёх таблиц:

* group
* target
* target_group
* target_group_link

## group

Содержит в себе наименование группы. 
На фронте отображается в виде некого раздела, который агрегирует в себе подразделы и\или цели.

## target 

Это конечная цель посещения, на фронте представлено кнопкой по нажатию на которую выдаётся талон.
Содержит наименование цели, описание (необязательное) и идентификатор цели.

## target_group

Содержит уникальный идентификатор, ссылку на group, ссылку на target.

## target_group_link

Содержит ссылку на основную запись target_group и ссылку на дочернюю запись target_group.


### Механизм работы

Логика следующая(иерархия всегда содержится в массиве, далее разбирается точечный элемент в массиве):
1. Если в таблице target_group заполнена только ссылка на target, и в target_group_link отсутствует ссылка на данную запись, значит в выходной массив добавляется элемент описывающий цель (и на мониторе отображается только наименование цели, по нажатию на которое выдаётся талон)
2. Если в таблице target_group_link фигурирует запись, с ссылкой на запись в  target_group, причём id записи из target_group лежит в target_group_link.target_group_main_id, то в выходной массив добавляется элемент, описывающий подраздел, содержащий подмассив child, содержащий объекты описывающие подразделы или конкретные цели.
3. Если в таблице target_group_link отсутствует запись со ссылкой на запись в target_group, и в target_group содержится запись с ссылкой на group и на target, то в выходной массив добавляется элемент, описывающий подраздел, содержащий подмассив child, содержащий объекты описывающие конкретные цели.

Поясняющая картинка приложена отдельно.


**Поясняющий пример**

```
[
  {
    "group": true,
    "name": "GroupA",
    "child": [
      {
        "group": true,
        "name": "GroupA_A",
        "child": [
          {
            "group": false,
            "name": "TargetA_A",
            "id": 123
          }
        ]
      },
      {
        "group": false,
        "name": "TargetA",
        "id": 23
      }
    ]
  },
  {
    "group": false,
    "name": "TargetB",
    "id": 31
  }
]
```


Здесь первый объект корневого анонимного массива, с name:GroupA - объект, который описывает подраздел. Наполнение этого подраздела описано в child, массиве объектов, каждый из которых может содержать вложенный объект описывающие подраздел, или же объект описывающий конечную цель.
В данном примере первый объект в массиве child, объекта с name:GroupA - также подраздел, с name:GroupA_A, который содержит массив из одного элемента, объекта описывающего конечную цель.

Следующий элемен массива child объекта c name:GroupA - объект описывающий конечную цель.

Следующий объект корневого анонимного массива описывает конечную цель.